<p align="center">
  <img width="100" src="./assets/failbot-logo.png" alt="failbot logo">
</p>
<p align="center">
  <img width="200" src="./assets/failbot-title.png" alt="failbot">
</p>

# Failbot for Qlik

## Prerequisites:
1. Latest version of [Node.js](https://nodejs.org/en/) installed on target PC. 

## How to run:
1. Download the certificates **in PEM format** from your Qlik Sense server and place in a folder called `certs` within the app's folder. See [Folder structure](#folderStructure) section below. Files needed: `client_key.pem`, `client.pem` and `root.pem`.

1. Create a config file that follows the structure from the [Config file section](#configFile) in the app's root folder.

1. Run: 
```shell
$ npm install --production
```

5. Use OS tools to schedule the execution of one of the commands below.
```shell
$ npm start
```
or 
```shell
$ node app.js
```


## <a name="folderStructure"></a> Folder structure
```
.
├── certs             # Certificates from the QMC
├── functions         
├── node_modules      # run `npm install --production` if you don't have this folder
├── output            # Where the logs are stored
├── test              
├── app.js            
├── settings.json     # See below      
└── README.md         # The file you are reading right now
```


## <a name="configFile"></a> Config file
```json
{
  "server": {
    "hostname": "development.myserver.internal",
    "externalHostname": "remoteaccess.myserver.com",
    "displayName": "My Dev Server",
    "xrfkey": "abcdefghijklmnop"
  },
  "slack": [
    {
      "webhook": "https://hooks.slack.com/services/...",
      "botName": "Company Failbot",
      "botEmoji": ":warning:",
      "displayIcon": "https://imgur.com/...",
      "channel": "#qlik-alerts",
      "customPropertyName": "alertOnSlack"
    }
  ],
  "logOutputFolder": "./output",
  "taskTypes": ["ReloadTask", "UserSyncTask"]
}
```


## Details

### Server
The **server** object holds the details for the Qlik Sense server.

`server.hostname` Base URL of the server. It should match the field `Host name` on /qmc/nodes/ e.g. _development.myserver.internal_

`server.externalHostname` **Optional** Base URL of the server when accessing it from outside the network. The value here will be used instead of `server.hostname` when building any links. E.g. _remoteaccess.myserver.com_

`server.displayName` Name for your server. E.g. _My Dev Server_

`server.xrfkey` String of 16 random characters used by the API call for security purposes


### Slack
The **slack** array holds many slack objects that contain the details to send the alerts.

`slack[].webhook` URL generated by using the _Incoming WebHooks_ Slack intregration.

`slack[].botName` Name for the bot. E.g. _Qlik Failbot_

`slack[].botEmoji` Emoji to display as icon when sending messages. Can be a custom emoji. E.g. `:warning:` for :warning:

`slack[].displayIcon` URL of an image that will display at the footer of the alerts. The size of this icon is as small as a website favicon.

`slack[].channel` Who receives the messages. `@name` for a specific user. `#my-channel` for a channel. `@user1,user2,user3` for a private group of users. E.g. `@jdoe` or `#qlik-alerts`

`slack[].customPropertyName` **Optional**. You can set a custom property for `Tasks` in Qlik Sense to send alerts from specific tasks to the channels/users of your choosing. `customPropertyName` must match the name of said Qlik Sense custom property, e.g. _alertsOnSlack_. The values in the custom property must match channels or users on Slack, e.g. `@jdoe` or `#qlik-alerts`.


#### Other settings

`logOutputFolder` Folder the app will use to keep track of what's been alerted so far. The app creates the folder if it doesn't exist and keeps it tidy. No need to manually clear them.

`taskTypes` Tasks to watch and alert, only two types available: `ReloadTask` and `UserSyncTask`.
